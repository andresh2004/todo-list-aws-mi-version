pipeline {
    agent any

    stages {
        stage('Get Code') {
            steps {
                echo '游닌 Descargando el c칩digo desde GitHub...'
                // Jenkins ya hace el checkout autom치tico si el job est치 bien configurado
            }
        }

        stage('Static Test') {
            steps {
                echo '游댌 Ejecutando an치lisis est치tico con flake8 y bandit...'
                sh 'pip install --user flake8 bandit'
                sh '''
                    export PATH=$PATH:$HOME/.local/bin
                    mkdir -p reports
                    flake8 src/ --format=html --htmldir=reports/flake8-report || true
                    bandit -r src/ -f html -o reports/bandit-report.html || true
                '''
            }
        }
    }

    post {
        always {
            echo '游닍 Publicando reportes de an치lisis est치tico...'
            publishHTML(target: [
                reportDir: 'reports',
                reportFiles: 'flake8-report/index.html',
                reportName: 'Flake8 Report'
            ])
            publishHTML(target: [
                reportDir: 'reports',
                reportFiles: 'bandit-report.html',
                reportName: 'Bandit Report'
            ])
        }
    }
}

